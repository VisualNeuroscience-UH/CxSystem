

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parallelism &mdash; CxSystem 0.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CxSystem 0.6 documentation" href="index.html"/>
        <link rel="next" title="Examples" href="examples.html"/>
        <link rel="prev" title="Configuration File Tutorial" href="config_tutorial.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CxSystem
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_tutorial.html">Configuration File Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Parallelism</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#array-runs">Array Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-run">Cluster Run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-environment">Setting up the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transferring-the-results">Transferring the Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CxSystem</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Parallelism</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/parallelism.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parallelism">
<h1>Parallelism<a class="headerlink" href="#parallelism" title="Permalink to this headline">¶</a></h1>
<p>CxSystem is and will be moving forward in synchrony with Brian2. Currently, parallelization in Brian2 is limited to GPU via GeNN simulator, and alpha version of multi-threading with OpenMP. Our framework supports both features for an individual simulation. This internal parallelization of Brian2 is probably going to happen in near future , and will be integrated in CxSystem. Yet, CxSystem supports parallelism in two forms: array_run and cluster_run. These features can be used for parameter search that automatically spawns multiple simulations on a workstation or a cluster and supports both python and stand-alone C++ devices.</p>
<div class="section" id="array-runs">
<h2>Array Runs<a class="headerlink" href="#array-runs" title="Permalink to this headline">¶</a></h2>
<p>Array run (Parallel runs) can be set using the curly braces around the target parameter. For instance, to run 3 separate simulationswith scale=1, scale=2 and scale=3, the parameter scale should be set to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="o">...</span>
<span class="o">...</span><span class="p">,{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},</span><span class="o">...</span>
</pre></div>
</div>
<p>This parallel run will use the number of processes (threads) that is set using the number_of_process parameter, e.g. if number_of_process=3, then each of the 3 simulations runs in their own threads. However, if number_of_process=2, two processes run first the simulation for scale=1, and scale=2. The third simulation with scale=3 will start when the first of the two simulations are completed.</p>
<p>The array_run could also be set in range with defined step:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="o">...</span>
<span class="o">...</span><span class="p">,{</span><span class="mi">1</span><span class="o">|</span><span class="mi">5</span><span class="o">|</span><span class="mi">1</span><span class="p">},</span><span class="o">...</span>
</pre></div>
</div>
<p>This parallel run will use four simulations with scale=1, scale=2, scale=3 and scale=4. Note the numpy style vector excluding the last index.</p>
<p>When two or more parameters are set to use array runs, CxSystem can run the parallel runs either as multi-dimensional runs or independent runs. For example: suppose a simulation is to be performed for scale {1,2,3} with do_init_vms set to {0,1}. If multidimension_array_run flag is set to 1, the following 6 simulations will be run separately:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">do_init_vms</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>When multidimension_array_run flag is set to 0, however, the array_run pattern is different and 5 simulations will be run in parallel:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="n">do_init_vms</span><span class="o">=</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">do_init_vms</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>One might want to run each of the parallel simulations several times, e.g. to observe an effect of a particular alteration in several runs.
For this purpose the <em>trials_per_config</em> should be set to number of runs per configuration.</p>
</div>
<div class="section" id="cluster-run">
<h2>Cluster Run<a class="headerlink" href="#cluster-run" title="Permalink to this headline">¶</a></h2>
<p>In Cluster Run mode, CxSystem connects to a connection node of a cluster via SSH and runs instances of array run on pre-defined number of nodes in the cluster. Currently Cluster Run is tested on <a class="reference external" href="https://research.csc.fi/taito-supercluster">Taito supercluster</a> that employs Slurm workload manager.  However, with a slight modification to the Slurm template file, one can use the cluster run on other types of workload manager systems, e.g. Torque.</p>
<div class="section" id="setting-up-the-environment">
<h3>Setting up the environment<a class="headerlink" href="#setting-up-the-environment" title="Permalink to this headline">¶</a></h3>
<p>Before submitting the batch jobs to the cluster with CxSystem, the cluster environment should be properly setup. This includes finding/copying/assigning the Anaconda folder in the Slurm file or environment. In case you are using a custom branch you should as well clone and checkout to that branch otherwise CxSystem will clone itself and try to spawn the processes using the master branch. The parameters that are used for cluster run are as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run_in_cluster</span>
<span class="mi">1</span>
</pre></div>
</div>
<p>which triggers the cluster run.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cluster_job_file_path</span>
<span class="o">./</span><span class="n">slurm</span><span class="o">.</span><span class="n">job</span>
</pre></div>
</div>
<p>This parameter defines the address of the template workload management system file. In this case the a template for Slurm system is made available in the Github page which can be used for any cluster that utilizes the Slurm. In case the cluster of choice uses another workload management system, the template file should be specified in the configuration file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cluster_number_of_nodes</span>
<span class="mi">10</span>
</pre></div>
</div>
<p>Defines how many nodes CxSystem can have access to in the cluster.
<strong>Important Note: the number of nodes in the cluster workload management system file should be set to 1 and instead the number of nodes should be defined here. The reason for this is that CxSystem submits separate jobs to the cluster. This has some advantages, including less waiting time, and some disadvantages, complexity.</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cluster_address</span>
<span class="n">taito</span><span class="o">.</span><span class="n">csc</span><span class="o">.</span><span class="n">fi</span>
</pre></div>
</div>
<p>Defines the URL of the cluster.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">username</span>
<span class="n">johnsmith</span>
</pre></div>
</div>
<p>Defines the username for the SSH connection.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remote_repo_path</span>
<span class="o">./</span><span class="n">CxSystem</span>
</pre></div>
</div>
<p>Defines the path of the CxSystem in the connection node of the cluster. In this example <em>./CxSystem</em> indicates that the CxSystem clone exists in the home folder, i.e. <em>~/</em>, in the connection node. If the repository clone does not exist there, then the latest version will be cloned and used. As mentioned earlier, in case the user is using a specific branch, CxSystem should be cloned and checked out manually. Otherwise the user can rely on CxSystem cloning itself in the connection node.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remote_output_folder</span>
<span class="o">./</span><span class="n">results</span>
</pre></div>
</div>
<p>Defines the folder in which the results will be copied. In this example, a new folder <em>results</em> will be created in the remote_repo_path folder and the results will be saved there.</p>
</div>
<div class="section" id="transferring-the-results">
<h3>Transferring the Results<a class="headerlink" href="#transferring-the-results" title="Permalink to this headline">¶</a></h3>
<p>Usually clusters have an option to send users an email when the job is finished and users can transfer the results to their local machine. CxSystem can do this automatically: When a batch job is submitted, beside generating several Slurm files, CxSystem creates a _tmp_checker_data file. This file, which contains information about the current cluster batch job, will be used to check the status of the results in the cluster. If the results are ready, they will be copied to the local result folder. This task can be done by directly running cluster_run.py.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="config_tutorial.html" class="btn btn-neutral" title="Configuration File Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Andalibi, V., Hokkanen H., Vanni, S..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>